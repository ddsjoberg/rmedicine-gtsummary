<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Reproducibility with {gtsummary}</title>
    <meta charset="utf-8" />
    <meta name="author" content="Daniel D. Sjoberg, Karissa Whiting" />
    <meta name="date" content="2020-08-28" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="my-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Reproducibility with {gtsummary}
### Daniel D. Sjoberg, Karissa Whiting
### August 28, 2020

---










# the problem

.pull-left[.large[
- Quality of medical research is often low

- Quality of code for medical research is low/non-existent

- Low quality code is more likely to contain errors

- Reproducibility is often difficult and time-consuming
]]

.pull-right[
&lt;p align="center"&gt;&lt;img src="images/reproducibility-graphic-online1.jpeg" width=90%&gt;&lt;/p&gt;
]


???

- reproducibility in medical research is a long-reported problem, and the code is an important part of this

- Doug Altman noted the quality of medical research in 1994 and called in a scandal

- I don't need to explain this to the people here though! One of the big themes of this year's conference is reproducibility

- Nature also reported the the reproducibility crisis in 2016

- At European Urology we asked authors to submit their code.
    - one-third of papers with nontrivial statistics indicated they did not use code
    - no submitted code satisfied the three basic principles of good software
    
- Nice output is HARD, and often takes a lot of custom coding and time. In a pinch, it's easier to not follow best practices.


---
# gtsummary: (a part of) the solution

.pull-left[.large[
- There are many tools available to increase reproducibility

- The gtsummary package makes it _incredibly_ easy to create the most common tables reported in the medical literature

]]

.pull-right[
&lt;p align="center"&gt;&lt;img src="images/logo.png" width=90%&gt;&lt;/p&gt;
]



???
- Wanted to create package geared towards medical research that made creating the most common tables as simple as possible
    - But also very flexible
    - Most packages for R use APA formatting...not helpful for medical journals (also, life, but that is just my opinion!)


---

class: inverse, center, middle

# Summarizing Data Frames with tbl_summary()

---
# summarize data with tbl_summary()

.large[**Example: Summarizing clinical study data**]

.pull-left[
.large[

**Goal**: Summarize data by treatment groups:
- Age
- Tumor Response
- Tumor Grade
]

```r
library(gtsummary)
library(tidyverse)

sm_trial &lt;-
  trial %&gt;%
  select(trt, age, grade, response)
```



]
.pull-right[
&lt;p align="center"&gt;&lt;img src="images/gt_trial_info.png" width=90%&gt;&lt;/p&gt;
]

???
- This is an abbreviated version of the example data used in the package help files/documentation. 

- note that the column have been labeled using the {labelled} package, and those are used throughout the package

---
# summarize data with tbl_summary()
.pull-left[
.large[
**Basic tbl_summary() code**
]


```r
tbl_summary_1 &lt;- 
  sm_trial %&gt;%
  tbl_summary(by = trt)
```

.medium[
- Default statistics are median (IQR) for continuous variables, and n (percent) for categorical data.

- By default, variables coded as 0/1, TRUE/FALSE, and Yes/No are presented dichotomously.

- add_p() - default tests are the Wilcoxon rank-sum test for continuous variables, chi-square test of independence/ Fisher's exact test for categorical (Fisher's for low expected counts).
]
]
.pull-right[
&lt;br&gt;
&lt;br&gt;
&lt;p align="center"&gt;&lt;img src="images/tbl_summary_1.png" width=85%&gt;&lt;/p&gt;
]

???
- Go slow here

- summarizing a data set is the MOST important analysis

- summarize data first!  you will often catch mistakes.  Data is complicated, and understanding it up front is important.

- Communicating a summary of the data ALONG with analytic results in necessary (others may catch mistakes you're not aware of)

- {gtsummary} is for presenting results, other great packages are available for summarizing data for your self (e.g. skimr)

- just one line of code

- all functions beginning with `tbl_*` create a new tables

- this is how I used the package 95% percent of the time...so easy

- three types of data shown here (explain them)

---
# {gtsummary} summarize data with tbl_summary()

.pull-left[
.large[
**Start Customizing Using Arguments**
]


```r
tbl_summary_3 &lt;- 
  sm_trial %&gt;%
  tbl_summary(
    by = trt,
    statistic = list(
      all_continuous() ~ "{mean} ({sd})",
      all_categorical() ~ "{n} / {N} ({p}%)"), 
    label = vars(age) ~ "Patient Age") %&gt;%
  add_p(test = all_continuous() ~ "t.test")
```


.medium[
- `statistic` - Report mean and standard deviation for continuous (default is median)
- `label` - Specify label for age
- `type` - Specify variable types
- `digits` - Specify number of decimals to round to
- `test`  [`add_p()`] - Report t-test p-values all continuous (default is Wilcoxan Rank Sum)
]
]
.pull-right[
&lt;p align="center"&gt;&lt;img src="images/tbl_summary_3.png" width=100%&gt;&lt;/p&gt;
]

???

- defaults are great, let's change the default behavior

- statistics can be changed to anything...literally any R function (e.g. variance)

- discuss the formula notation
    - it's like `case_when()`, condition/variable on LHS and result on RHS
    - one formula doesn't need to be in a list, but more than one must be listed

- the vignette has examples with more examples



---
# {gtsummary} tbl_summary() Formulas
.large[
**Formulas**


- Most arguments to `tbl_summary()` now require formula syntax, and provide many more options to easily select the table variables you want to modify.   
&lt;br&gt;
&lt;br&gt;

.center[

**select variables ~ specifiy what you want to do** 
]
]

???
- case_when uses similar syntax 
---
# {gtsummary} tbl_summary() Formulas
.large[
**Formulas**


- Most arguments to `tbl_summary()` now require formula syntax, and provide many more options to easily select the table variables you want to modify.   

.center[

&lt;br&gt;

**select variables ~ specifiy what you want to do** 

]


```r
tbl_summary(
  by = trt,
  statistic = age ~ "{mean} ({sd})" 
)
```
]


---
# {gtsummary} tbl_summary() Formulas
.large[
**Formulas**
.center[

**select variables ~ specifiy what you want to do** 
]

- **select variables**
    - use variable name, e.g. `age ~ ...` or `c(age, grade) ~ ...`
    - use any {tidyselect} functions, e.g. `contains("stage") ~ ...`
    - use summary type, e.g. `all_continuous() ~ ...`
    
- **specifiy what you want to do** (depends on the argument)
    - change the statistic you report using {glue} syntax. e.g `statistic = ... ~ "{mean} ({sd})"`
    - pass a string to change labels 
]

---
# {gtsummary} tbl_summary() Formulas

.pull-left[

```r
tbl_summary_4 &lt;- 
  sm_trial %&gt;%
  tbl_summary(
    by = trt,
    type = vars(response) ~ "categorical",  #&lt;&lt;
    statistic = all_continuous() ~ "{mean} ({sd})",  #&lt;&lt;
    digits = vars(age) ~ c(0, 1)  #&lt;&lt;
  ) %&gt;%
  add_p(test = all_continuous() ~ "t.test") 
```

.large[
- Report levels for the response variable.
- Report mean instead of median (using glue)
- Modify the default rounding for age.


]
]
.pull-right[
&lt;p align="center"&gt;&lt;img src="images/tbl_summary_4.png" width=100%&gt;&lt;/p&gt;
]

???

- further discuss formula notation
    - just like {gt} can use both select helpers OR characters vector of names

- discuss digits and how it's used

- discuss `stat_label = `, and mention the footnote was omitted

---
# {gtsummary} summarize data with tbl_summary()

.large[
**New `tbl_summary` Features**

- Use tidyselect and additional selector functions for arguments 

- Write custom functions for calculating p-values 

- Table footnotes (you can optionally exclude these using `as_gt(exclude = "footnote_stat_label")` )

- Sort variables by significance (`sort_p()`)

- Calculate cell percents and row percents (default is column-wide)

- Only report p-values for select variables (`add_p(exclude = ...)`)

- Improved rounding options and ability to set global options for rounding p-values

]

???
- these are new features many added by request

---
# {gtsummary} tbl_summary() advanced customization
.large[**Advanced Customization Using {gt}**

- It's natural a {gtsummary} package user would want to customize the aesthetics of the table with one or more of the many {gt} functions available.  

- Every function in {gt} is available to use with a {gtsummary} object.

1. Create a {gtsummary} table.

1. Convert the table to a {gt} object with the `as_gt()` function.

1. Continue formatting as a {gt} table with any {gt} function.
]

???

Discuss `as_gt()` and how to use

---
# {gtsummary} tbl_summary() advanced customization
.large[**Advanced Customization Using {gt}**

- tab_header() - add a table title

- tab_spanner() - add headers that span columns

- tab_options() - change table padding and font size

- tab_footnote() - add additional footnotes to table

And many more! https://gt.rstudio.com/
]

---
class: left
# {gtsummary} summarize data with tbl_summary()

.large[
Review the tbl_summary vignette for more details
http://www.danieldsjoberg.com/gtsummary/articles/tbl_summary.html
]

.pull-left[.large[
- Reporting any statistic for continuous variables, including user-written functions.

- More on dichotomous variables and how to specify the level printed.

- Missing data options (e.g. report as a column rather than a row, always report N missing even when no missing data, modify missing text, etc.).
]]
.pull-right[.large[
- Sort categorical variables by frequency.

- Report row percent, rather than column percent.

- Report q-values from various methods like false discovery rate.

- Sort data by ascending p-values when comparisons have been made.
]]

???

There is more that we are not covering here

---

class: inverse, center, middle

# tbl_regression

---

class: inverse, center, middle

# Themes

---

class: inverse, center, middle

# Printing

---

class: inverse, center, middle

# Thank You
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
